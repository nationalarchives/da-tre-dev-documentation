# How to assume roles using the AWS CLI

## AWS Command Line Interface (CLI)

The [AWS Command Line Interface](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html) (AWS CLI) is an open source tool that enables you to interact with AWS services using commands in your command-line shell. With minimal configuration, the AWS CLI enables you to start running commands that implement functionality equivalent to that provided by the browser-based AWS Management Console from the command prompt in your terminal program:

- **Linux shells** – Use common shell programs such as bash, zsh, and tcsh to run commands in Linux or macOS.
- **Windows command line** – On Windows, run commands at the Windows command prompt or in PowerShell.
- **Remotely** – Run commands on Amazon Elastic Compute Cloud (Amazon EC2) instances through a remote terminal program such as PuTTY or SSH, or with AWS Systems Manager.

### [Configuration and credential file settings](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html)

The AWS CLI stores sensitive credential information that you specify with `aws configure` in a local file named `credentials`, in a folder named `.aws` in your home directory. The less sensitive configuration options that you specify with `aws configure` are stored in a local file named `config`, also stored in the `.aws` folder in your home directory.

For example, the files generated by the AWS CLI for a default profile configured with aws configure looks similar to the following.

`~/.aws/credentials`

```
[default]
aws_access_key_id=AKIAIOSFODNN7EXAMPLE
aws_secret_access_key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
```

## Assuming roles

### AWS Console

![image-1](./images/image-1.png)

You should always login to the Users account with the credentials provided and using your MFA token.  Once authenticated, you should select your name from the top-right of the console page.

```
Note: some roles will be cached inside your browser - generally only the most recently used 5 will be shown.  You should ensure you keep a record of any assume-role details you will need.
```

You may select a role you have previously used directly from the list, or choose "Switch role" to enter details of one not listed

![image-2](./images/image-2.png)

Enter the details and choose a colour to associate with the role in the history display and when using it in the console.  Once you have assumed the role, you will be able to see what role you are using by clicking the descriptive name you assigned it in the top-right of the console pages:

![image-3](./images/image-3.png)

You can choose "Switch back" to return to the users account, or select any other role from the history if you need to switch back and forth between them.


### AWS CLI and SDKs

TO DO



TO DO

```bash
AWS CLI Developer Configuration:
~/.aws/config :

[profile tna-user]
region = eu-west-2
output = json

[profile tna-dev-mgmt]
region = eu-west-2
output = json
source_profile = tna-user
role_arn = arn:aws:iam::454286877087:role/zaizi/Zaizi_Dev_Role
mfa_serial = arn:aws:iam::528553943715:mfa/YOUR_IAM_USERNAME

[profile tna-dev-nonprod]
region = eu-west-2
output = json
source_profile = tna-user
role_arn = arn:aws:iam::882876621099:role/zaizi/Zaizi_Dev_Role
mfa_serial = arn:aws:iam::528553943715:mfa/YOUR_IAM_USERNAME

[profile tna-dev-prod]
region = eu-west-2
output = json
source_profile = tna-user
role_arn = arn:aws:iam::642021068869:role/zaizi/Zaizi_Dev_Role
mfa_serial = arn:aws:iam::528553943715:mfa/YOUR_IAM_USERNAME

Replace the YOUR_IAM_USERNAME values with the username you login to the AWS console, and add your credentials as follows
~/.aws/credentials:
[tna-user]
aws_access_key_id = <YOUR_KEY_FROM_AWS>
aws_secret_access_key = <YOUR_KEY_FROM_AWS>

to use a profile, e.g.:
aws --profile=tna-dev-prod s3 ls
alternatively to set environment variable:
export AWS_PROFILE=tna-dev-prod
then run your commands as normal
```